require "mechanize"
require "PageMapper"

vendors = ["http://www.flipkey.com/frontdesk/view/39860/summit+54+vacation+property+management+llc", "http://www.flipkey.com/frontdesk/view/247/jackson+mountain+homes", "http://www.flipkey.com/frontdesk/view/238/american+patriot+getaways", "http://www.flipkey.com/frontdesk/view/28342/auntie+belham+s+cabin+rentals+inc", "http://www.flipkey.com/frontdesk/view/116970/timber+tops+cabin+rentals", "http://www.flipkey.com/frontdesk/view/115318/gatlinburg+falls+resort", "http://www.flipkey.com/frontdesk/view/6811/eden+crest+vacation+rentals+inc", "http://www.flipkey.com/frontdesk/view/12921/holiday+isle+properties+inc", "http://www.flipkey.com/frontdesk/view/58509/itrip+vacation+rentals+-+destin+florida", "http://www.flipkey.com/frontdesk/view/93612/pat+and+jerry+cahoon", "http://www.flipkey.com/frontdesk/view/256/beach+realty+kitty+hawk+rentals", "http://www.flipkey.com/frontdesk/view/257/resort+realty+outer+banks", "http://www.flipkey.com/frontdesk/view/274/southern+shores+realty", "http://www.flipkey.com/frontdesk/view/64425/village+realty", "http://www.flipkey.com/frontdesk/view/163/surf+or+sound+realty", "http://www.flipkey.com/frontdesk/view/425/grand+strand+vacations+and+rentals", "http://www.flipkey.com/frontdesk/view/53992/teeoff+beach+inc", "http://www.flipkey.com/frontdesk/view/84911/bluewater+resort", "http://www.flipkey.com/frontdesk/view/68627/wyndham+vacation+rentals+-+myrtle+beach", "http://www.flipkey.com/frontdesk/view/123005/pam+britt", "http://www.flipkey.com/frontdesk/view/49/seaside+rentals+premier+vacation+homes", "http://www.flipkey.com/frontdesk/view/47/surfside+realty", "http://www.flipkey.com/frontdesk/view/63643/chad+wade", "http://www.flipkey.com/frontdesk/view/39864/price+morgan+vacation+rentals+llc", "http://www.flipkey.com/frontdesk/view/41693/holiday+properties", "http://www.flipkey.com/frontdesk/view/25179/brian+mitchell", "http://www.flipkey.com/frontdesk/view/120805/buena+vista+vacation", "http://www.flipkey.com/frontdesk/view/635/wyndham+vacation+rentals+-+northwest+florida", "http://www.flipkey.com/frontdesk/view/20067/dennis+r+fuller", "http://www.flipkey.com/frontdesk/view/41558/jgs+beachside+rentals", "http://www.flipkey.com/frontdesk/view/40985/greta", "http://www.flipkey.com/frontdesk/view/122033/rs+vacations", "http://www.flipkey.com/frontdesk/view/30067/big+bear+luxury+properties", "http://www.flipkey.com/frontdesk/view/23219/five+star+vacation+rentals", "http://www.flipkey.com/frontdesk/view/124/big+bear+vacations", "http://www.flipkey.com/frontdesk/view/27290/tony+moran", "http://www.flipkey.com/frontdesk/view/25059/big+bear+dream+cabins", "http://www.flipkey.com/frontdesk/view/10586/jeffrey+r+hultman", "http://www.flipkey.com/frontdesk/view/3699/big+bear+cool+cabins", "http://www.flipkey.com/frontdesk/view/58973/pretty+picky+properties", "http://www.flipkey.com/frontdesk/view/166/the+rental+company+at+william+raveis", "http://www.flipkey.com/frontdesk/view/313/new+england+vacation+rentals", "http://www.flipkey.com/frontdesk/view/30954/margaret+c", "http://www.flipkey.com/frontdesk/view/17/capecodrentals+com", "http://www.flipkey.com/frontdesk/view/47382/kinlin+grover+vacation+rentals", "http://www.flipkey.com/frontdesk/view/41008/heather+davis+rental+agent", "http://www.flipkey.com/frontdesk/view/309/sand+dollar+realty", "http://www.flipkey.com/frontdesk/view/126622/dan+holland", "http://www.flipkey.com/frontdesk/view/104970/hopper+real+estate", "http://www.flipkey.com/frontdesk/view/123825/carol+le+suer", "http://www.flipkey.com/frontdesk/view/65784/penny+realty", "http://www.flipkey.com/frontdesk/view/11698/elizabeth+callaway", "http://www.flipkey.com/frontdesk/view/29597/mission+sands", "http://www.flipkey.com/frontdesk/view/4084/sunny+san+diego+vacation+rentals", "http://www.flipkey.com/frontdesk/view/51179/san+diego+sunset+vacation+rentals", "http://www.flipkey.com/frontdesk/view/12453/nancy+s+vacation+rentals", "http://www.flipkey.com/frontdesk/view/4532/bluewater+vacation+homes", "http://www.flipkey.com/frontdesk/view/5102/susan+p", "http://www.flipkey.com/frontdesk/view/12/all+star+vacation+homes", "http://www.flipkey.com/frontdesk/view/10059/la+jolla+vacation+rentals+ca", "http://www.flipkey.com/frontdesk/view/121137/next+stop+san+diego", "http://www.flipkey.com/frontdesk/view/221/sandy+beach+rentals", "http://www.flipkey.com/frontdesk/view/3031/london+guest+suites", "http://www.flipkey.com/frontdesk/view/52122/fortin+jeremy", "http://www.flipkey.com/frontdesk/view/15871/paris-+sharing+com", "http://www.flipkey.com/frontdesk/view/3724/paris+be+a+part+of+it+com", "http://www.flipkey.com/frontdesk/view/61587/lars+sipila", "http://www.flipkey.com/frontdesk/view/1129/vacation+in+paris", "http://www.flipkey.com/frontdesk/view/3365/elite+destination+homes", "http://www.flipkey.com/frontdesk/view/23061/brendan+strady", "http://www.flipkey.com/frontdesk/view/5668/holiday+france+rentals", "http://www.flipkey.com/frontdesk/view/1626/paris+for+rent", "http://www.flipkey.com/frontdesk/view/37009/mycentralapartments", "http://www.flipkey.com/frontdesk/view/50045/paris+furnished+apartments", "http://www.flipkey.com/frontdesk/view/10503/welcome2france", "http://www.flipkey.com/frontdesk/view/647/paris+perfect", "http://www.flipkey.com/frontdesk/view/8701/marie+d", "http://www.flipkey.com/frontdesk/view/8928/linda+vandermarliere", "http://www.flipkey.com/frontdesk/view/4465/rent+paris+now+llc", "http://www.flipkey.com/frontdesk/view/21255/paris+rental+connections", "http://www.flipkey.com/frontdesk/view/89313/squarebreak", "http://www.flipkey.com/frontdesk/view/47171/lodgis", "http://www.flipkey.com/frontdesk/view/85941/kami+farman", "http://www.flipkey.com/frontdesk/view/56038/my+apartment+in+paris", "http://www.flipkey.com/frontdesk/view/36635/short+time+rental", "http://www.flipkey.com/frontdesk/view/42477/elier+l", "http://www.flipkey.com/frontdesk/view/18256/jimmy+miranda", "http://www.flipkey.com/frontdesk/view/60663/sebastian+humbert", "http://www.flipkey.com/frontdesk/view/126478/antonio+segarra", "http://www.flipkey.com/frontdesk/view/63530/carmen+leon", "http://www.flipkey.com/frontdesk/view/40837/deborah+okeeffe", "http://www.flipkey.com/frontdesk/view/31002/virginia+sedo", "http://www.flipkey.com/frontdesk/view/7812/bravos+boyz", "http://www.flipkey.com/frontdesk/view/129642/elizabeth+n", "http://www.flipkey.com/frontdesk/view/36102/palmas+vacation+rentals", "http://www.flipkey.com/frontdesk/view/19060/marsters+villa+rentals", "http://www.flipkey.com/frontdesk/view/63691/luann+c", "http://www.flipkey.com/frontdesk/view/125595/carlos+la+verde", "http://www.flipkey.com/frontdesk/view/42864/isabel+martinez", "http://www.flipkey.com/frontdesk/view/125694/mark+m+brown", "http://www.flipkey.com/frontdesk/view/58591/lissette+soriano", "http://www.flipkey.com/frontdesk/view/125642/puerto+rico", "http://www.flipkey.com/frontdesk/view/62879/valdivia+family", "http://www.flipkey.com/frontdesk/view/73835/r+vacation+rentals", "http://www.flipkey.com/frontdesk/view/95902/gianluca+p", "http://www.flipkey.com/frontdesk/view/31792/apartments+florence", "http://www.flipkey.com/frontdesk/view/41504/salogi+srl", "http://www.flipkey.com/frontdesk/view/1925/summer+in+italy", "http://www.flipkey.com/frontdesk/view/36263/marina", "http://www.flipkey.com/frontdesk/view/10907/hidden+italy", "http://www.flipkey.com/frontdesk/view/760/windows+on+italy", "http://www.flipkey.com/frontdesk/view/8202/rossella", "http://www.flipkey.com/frontdesk/view/17917/villa+charme", "http://www.flipkey.com/frontdesk/view/30521/danila+corinti", "http://www.flipkey.com/frontdesk/view/94767/easy+reserve+ltd", "http://www.flipkey.com/frontdesk/view/23391/la+bella+toscana", "http://www.flipkey.com/frontdesk/view/47191/enrico", "http://www.flipkey.com/frontdesk/view/11048/enrica", "http://www.flipkey.com/frontdesk/view/51882/podere+pievina", "http://www.flipkey.com/frontdesk/view/47634/italian+style+villas", "http://www.flipkey.com/frontdesk/view/100159/ciao+italy+pty+ltd", "http://www.flipkey.com/frontdesk/view/8860/andrea+bruni", "http://www.flipkey.com/frontdesk/view/9222/luxury+retreats", "http://www.flipkey.com/frontdesk/view/35380/cristina", "http://www.flipkey.com/frontdesk/view/716/italy+perfect", "http://www.flipkey.com/frontdesk/view/18364/jacopo+baiocco", "http://www.flipkey.com/frontdesk/view/59502/stefano+tiziana", "http://www.flipkey.com/frontdesk/view/102667/vacavilla+srl", "http://www.flipkey.com/frontdesk/view/19987/oliver+s+travels", "http://www.flipkey.com/frontdesk/view/43083/trudi+barnet+michael+oldridge", "http://www.flipkey.com/frontdesk/view/810/invitation+to+tuscany+ltd", "http://www.flipkey.com/frontdesk/view/21024/travel+keys", "http://www.flipkey.com/frontdesk/view/634/rentvillas+com", "http://www.flipkey.com/frontdesk/view/44599/sweet+dreams+barcelona", "http://www.flipkey.com/frontdesk/view/3762/apartment+barcelona", "http://www.flipkey.com/frontdesk/view/18233/cocoon+apartments", "http://www.flipkey.com/frontdesk/view/83978/you+stylish+apartments", "http://www.flipkey.com/frontdesk/view/52389/travellingto", "http://www.flipkey.com/frontdesk/view/55075/enjoy+apartments", "http://www.flipkey.com/frontdesk/view/24666/lodging+apartments", "http://www.flipkey.com/frontdesk/view/8093/bizflats", "http://www.flipkey.com/frontdesk/view/33099/clickandflat+com", "http://www.flipkey.com/frontdesk/view/60830/vacasol", "http://www.flipkey.com/frontdesk/view/39902/barcelona+for+rent+apartments", "http://www.flipkey.com/frontdesk/view/88476/urban+rent", "http://www.flipkey.com/frontdesk/view/10799/the+villa+group", "http://www.flipkey.com/frontdesk/view/38070/4u+apartments+barcelona", "http://www.flipkey.com/frontdesk/view/38960/barcelona+apartments", "http://www.flipkey.com/frontdesk/view/62047/nuria", "http://www.flipkey.com/frontdesk/view/5662/rent+the+sun"] 

schema = {
  :name => String,
  :photo => String,
  :details => {
    :location => String,
    :phone_number => String
  },
  :overall_rating => Integer, 
  :rating_breakdown => [
    {
      :level => String,
      :rate => Integer 
    }
  ],
  :listings => [String]
}

rules = {
  :name => "h1 text()",
  :photo => "#photo-primary:first-child @src",
  :details => {
    :location => ':content("Office located in:")+ .text_data > text()',
    :phone_number => ':content("Phone number:")+ .text_data > text()'
  },
  :overall_rating => "#fd_sidebar .general-rating-full @style", 
  :rating_breakdown => [
    {
      :level => ".rate_line #rate-description > text()",
      :rate => ".rate_line" 
    }
  ],
  :listings => [".overview .pdp-link > text()"]
}

mapper = PageMapper.new schema: schema, rules: rules 
names = [] 
vendors.each do |url|
	data = mapper.data_from(url)
	puts data[:name]
	names << data[:name]
	Profile.create(data)
end

puts names.inspect

# ["Summit 54 Vacation Property Management LLC", "Jackson Mountain Homes", "American Patriot Getaways", "Auntie Belham's Cabin Rentals, Inc.", "Timber Tops Cabin Rentals", "Gatlinburg Falls Resort", "Eden Crest Vacation Rentals, Inc", "Holiday Isle Properties, Inc.", "iTrip Vacation Rentals - Destin, Florida", "Pat and Jerry Cahoon", "Beach Realty Kitty Hawk Rentals", "Resort Realty Outer Banks", "Southern Shores Realty", "Village Realty", "Surf or Sound Realty", "Grand Strand Vacations and Rentals", "Teeoff Beach Inc", "Bluewater Resort", "Wyndham Vacation Rentals - Myrtle Beach", "Pam Britt", "Seaside Rentals Premier Vacation Homes", "Surfside Realty", "Chad Wade", "Price Morgan Vacation Rentals, LLC", "Holiday Properties", "Brian Mitchell", "Buena Vista Vacation", "Wyndham Vacation Rentals - Northwest Florida", "Dennis R Fuller", "JGs Beachside Rentals", "Greta", "RS Vacations", "Big Bear Luxury Properties", "Five Star Vacation Rentals", "Big Bear Vacations", "tony moran", "Big Bear Dream Cabins", "Jeffrey R Hultman", "Big Bear Cool Cabins", "Pretty Picky Properties", "The Rental Company at William Raveis", "New England Vacation Rentals", "Margaret C.", "CapeCodRentals.com", "Kinlin Grover Vacation Rentals", "Heather Davis Rental Agent", "Sand Dollar Realty", "Dan Holland", "Hopper Real Estate", "Carol Le Suer", "Penny Realty", "Elizabeth Callaway", "Mission Sands", "Sunny San Diego Vacation Rentals", "San Diego Sunset Vacation Rentals", "Nancy's Vacation Rentals", "Bluewater Vacation Homes", "Susan P.", "All Star Vacation Homes", "La Jolla Vacation Rentals Ca", "Next Stop: San Diego", "Sandy Beach Rentals", "London Guest Suites", "Fortin Jeremy", "Paris- Sharing.com", "Paris Be A Part Of It.com", "Lars Sipila", "Vacation In Paris", "Elite Destination Homes", "Brendan Strady", "Holiday France Rentals", "Paris For Rent", "MyCentralApartments", "Paris Furnished Apartments", "Welcome2France", "Paris Perfect", "Marie D.", "Linda VanderMarliere", "Rent Paris Now, LLC", "Paris Rental Connections", "Squarebreak", "Lodgis", "Kami Farman", "My Apartment in Paris", "Short Time Rental", "Elier L.", "Jimmy Miranda", "Sebastian Humbert", "Antonio Segarra", "Carmen Leon", "Deborah OKeeffe", "Virginia &amp; Sedo", "Bravos Boyz", "Elizabeth N.", "Palmas Vacation Rentals", "Marsters Villa Rentals", "Luann C", "Carlos La Verde", "Isabel Martinez", "Mark M Brown", "Lissette Soriano", "Puerto Rico", "Valdivia Family", "R. Vacation Rentals", "gianluca p.", "Apartments Florence", "Salogi Srl", "Summer In Italy", "Marina", "Hidden Italy", "Windows on Italy", "Rossella", "Villa &amp; Charme", "danila corinti", "Easy Reserve Ltd", "La Bella Toscana", "Enrico", "Enrica", "Podere Pievina", "Italian Style Villas", "Ciao Italy Pty Ltd", "Andrea Bruni", "Luxury Retreats", "Cristina", "Italy Perfect", "jacopo baiocco", "Stefano &amp; Tiziana", "Vacavilla Srl", "Oliver's Travels", "Trudi Barnet &amp; Michael Oldridge", "Invitation to Tuscany Ltd", "Travel Keys", "Rentvillas.com", "Sweet Dreams Barcelona", "Apartment Barcelona", "Cocoon Apartments", "You Stylish Apartments", "TravellingTo", "Enjoy Apartments", "Lodging Apartments", "bizFlats", "Clickandflat.com", "Vacasol", "Barcelona For Rent apartments", "Urban Rent", "The Villa Group", "4U Apartments Barcelona", "Barcelona Apartments", "Nuria", "Rent The Sun"]
